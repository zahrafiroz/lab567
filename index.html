<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Drug overdose death rates, by drug type, sex, age, race, and Hispanic origin: United States</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <!-- include google web fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web|Oswald" rel="stylesheet">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css" rel="stylesheet">
    <!-- include icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="c3.min.css">
    <link rel="stylesheet" href="style.css" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>
    <!-- include c3.js to make charts. c3.js is built upon d3.js -->
    <script src="d3.js"></script>
    <script src="c3.min.js"></script>
</head>

<body>
    <!-- sidebar -->
    <div id="info">
        <div id="title">
            Overdose deaths in the USA by; drug type, sex, age, race, and Hispanic origin
            <span><a href="https://catalog.data.gov/dataset/drug-overdose-death-rates-by-drug-type-sex-age-race-and-hispanic-origin-united-states-3f72f" target="_blank"><i class="bi bi-twitter"></i></a></span>
            <span><a href="https://github.com/zahrafiroz" target="_blank"><i class="bi bi-github"></i></a></span>
            <span id="reset"><a href="#">reset</a></span>
        </div>
        <div id="count" class="card">
            <h5 id="desc"> # Overdose deaths in the Region</h5>
            <p id="overdose-count"></p>
        </div>
        <div id="overdose-chart"></div>

        <div id="footer">
            The data provided in this smart dashboard was taken from catalog.data.gov
            Published by: Centers for Disease Control and Prevention
            Maintained by: National Center for Health Statistics
        </div>
    </div>
    <div id="map"></div>
    <div id="legend"></div>
    <script         
        mapboxgl.accessToken =
            'pk.eyJ1IjoiemFocmFmaXJveiIsImEiOiJjbHJ0b2U5OWcwOGZ1MnJvZWd5eHJxZHRiIn0.UAlpZ7eUZCoP02oOa7xGKA';

        // declare the map object
        let map = new mapboxgl.Map({
            container: 'map', // container ID
            style: 'mapbox://styles/zahrafiroz/cls4dhddy00em01pv8d592j3s',
            zoom: 5, // starting zoom
            minZoom: 5,
            center: [39.499,-96.064] // starting center
             async function geojsonFetch() {

            // Await operator is used to wait for a promise. 
            // An await can cause an async function to pause until a Promise is settled.
            let response;
            response = await fetch('overdose.geojson');
            earthquakes = await response.json();



            //load data to the map as new layers.
            //map.on('load', function loadingData() {
            map.on('load', () => { //simplifying the function statement: arrow with brackets to define a function

                // when loading a geojson, there are two steps
                // add a source of the data and then add the layer out of the source
                map.addSource('overdose', {
                    type: 'geojson',
                    data: overdose
                });
        map.addLayer({
                        'id': 'overdose-point',
                        'type': 'circle',
                        'source': 'overdose',
                        'minzoom': 5,
                        'paint': {
                            // increase the radii of the circle as mag value increases
                            'circle-radius': {
                                'property': 'count',
                                'stops': [
                                    [grades[0], radii[0]],
                                    [grades[1], radii[1]],
                                    [grades[2], radii[2]]
                                ]
                            },
                            // change the color of the circle as mag value increases
                            'circle-color': {
                                'property': 'count',
                                'stops': [
                                    [grades[0], colors[0]],
                                    [grades[1], colors[1]],
                                    [grades[2], colors[2]]
                                ]
                            },
                            'circle-stroke-color': 'white',
                            'circle-stroke-width': 1,
                            'circle-opacity': 0.6
                        }
                    },
                                     map.on('click', 'overdose-point', (event) => {
                    new mapboxgl.Popup()
                        .setLngLat(event.features[0].geometry.coordinates)
                        .setHTML(`<strong>DeathCount:</strong> ${event.features[0].properties.mag}`)
                        .addTo(map);
                });



        });
        
    </script>
</body>

</html>
